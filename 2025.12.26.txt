
스노트(Snort) 
- 1998년 마틴 로쉬가 오픈 소스로 개발
- 시그니처 기반 네트워크 침입 탐지 시스템
- 작동 방식 : Sniffer Mode, Packet Logging Mode, NIDS Mode, IPS Mode

- 스니퍼 : 네트워크 패킷 수집
- 패킷 디코더 : 전처리기와 탐지 엔진이 파싱 할 수 있도록 정규화
- 전처리기 : 특정 행위가 발견된 패킷을 탐지 엔진으로 전송
- 탐지엔진 : 전달받은 패킷을 스노트 규칙에 매칭되는 지 확인
경고/로깅 : 스노트 규칙에 매칭된 경우 경고 출력 및 기록

오탐 : 공격이 아닌 것을 공격으로 탐지하는 경우를 말한다. 행위 기반의 탐지 시스템의 경우 임계치 설정이 미흡하면 오탐이 다수 발생할 수 있다.
미탐 : 공격을 탐지하지 못하는 경우, 시그니처(signature) 기반 탐지 시스템의 경우 등록된 시그니처 외의 공격에 대해서는 탐지를 못하는 한계가 있다.


sid :  룰 아이디 정보
rev :  룰 수정 횟수(revison)
priority : 우선순위
classtype : 룰에 대한 이벤트 유형 정보
reference : 룰과 관련된 취약점 정보 (CVE 식별자에 대한 상세 정보 URL링크를 제공)

- SID
99이하 시스템 내부에서 사용
100 ~ 1,000,000 외부에서 제작해 배포하는 탐지 규칙에서 사용
1,000,001 이상 사용자가 local.rules 탐지 규칙을 설정할 때 사용



- 수행 가능 공격 기법
- 툴 기능(공격 기법, 프로그램)



- 수행 가능 공격 기법
- 툴 기능(공격 기법, 프로그램)

DoS, DDoS, DRDoS 차이점

네트워크 계층 공격
랜드(LAND) 공격 : IP 스푸핑 공격을 변형한 공격, 출발지, 목적지  주소 동일, 
대상자는 ICMP응답 패킷을 전송하기 위해 출발지 주소를 참조, 자신에게 보낸다.
(네트워크 계층의 플러딩공격) 랜드 공격을 전송 계층까지 확장해 사용, 
### 현재 운영 체제에서는 출발지,도착지 IP주소가 동일시 커널에서 차단

티얼드롭(Teardrop) : 네트워크  계층의 대표적인 공격, 패킷 분할 속성을 이용한 기법,(여타 공격처럼 플러딩 공격)
IP 패킷의 재조합(reassembly) 과정에서 잘못된 fragment offset 정보로 인해 수신시스템이 문제가 발생하도록 만드는 DoS공격
네트워크 계층 플래그먼트 오프셋  0, 1500, 3000, 4500 도착시 정상적인 조립이 가능하다
하지만 0, 1500, 1500, 4500 으로 조작시 두번째 분할 패킷까지는 정상적으로 재조립을 하지만 이후 패킷은 두번째를 덮어써버려 운영체제에서는
3000을 계속 검색한다 이과정에서 과부하가 일어난다.
### 현재 대부분의 운영체제에서는 플래그먼트 오프셋 정보가 불일치할 경우 분할 패킷 전체를 폐기함, 티얼드롭 공격을 원천적으로 차단
- 유사한 공격으로 Bonk, Boink가 있다.
IP Fragmentation 취약점을 이용한 침입 차단시스템 우회 공격 (DoS 가 아니다)
Tiny Fragment : Ip헤더 보다 작은 fragment(단편)을 만들어서 침입차단시스템 방화벽을 우회하여 내부 시스템이 칩입하는 공격기법으로 DoS 공격 기법이 아닌 우회 공격 기법이다.
Fragment Overlap : ip fragment의 offset 값을 조작해 서비스 포트 필드를 중첩치켜서 재조합이 되고 나면 침입차잔시스템(방화벽)에서 허용하지 않는 서비스에 접근 가능하게 만드는 공격 기법으로 DoS 공격 기법이 아닌 우회 공격 기법이다.
예) [IP][TCP][80] 두번째 [TCP][22][data] 재조합 [IP][TCP][22][data] 가 되도록 공격
대응책 : OS의 보안 패치를 모두 설치하여 OS의 취약점 해소

ICMP 플러딩(flooding),  죽음의 핑 공격으로도 불린다
중국의 인구가 동시에 핑을 날린다고 생각하면 된다.
ICMP 플러딩 공격은 보통 ICMP 페이로드 크기를 65,000 바이트 이상으로 설정하고  IP스푸핑 공격을 적용해 출발 주소를 매 순간 임의로 변경 전송한다.
수신측에선 매번 분할 패킷을 재조립한 뒤 ICMP 응답 패킷을 전송해야 하기 때문에 그만큼 과부하가 크다.
랜드공격과 결합한 ICMP 플러딩 공격
hping3 192.168.0.18 -a 192.168.0.18 --icmp --flood -d 65000
HPING 192.168.0.18 (eth0 192.168.0.18): icmp mode set, 28 headers + 6500 data bytes 
(65,000바이트의 ICMP 페이로드 생성후 ICMP 8byte + 헤드 20byte 붙여 공격)
echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all

ICMP Smurfing 공격 : ICMP 플러딩 공격의 변형
대상자의 IP주소를 출발지 IP주소로 설정하고 목적지 주소를 브로드캐스트 주소로 설정
공격자가 전송한 ICMP 패킷은 전송한 대역에 모든 호스트에 전해지고 요청을 받은 호스트는 출발지 주소를 참고하여 응답한다.
대역에 있는 호스트로부터 ICMP 응답 패킷을 받기 때문에 과부하가 일어난다.
hping3 192.168.0.255 -a 192.168.0.18 --icmp --flood -d 65000
echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts  (비활성)


브로드캐스트 IP주소를 사용
root@roror-virtual-machine:~# echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
root@roror-virtual-machine:~# ping 192.168.0.255 -b  (모든 호스트에 ICMP를 요청)
WARNING: pinging broadcast address
PING 192.168.0.255 (192.168.0.255) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=64 time=0.128 ms
64 bytes from 192.168.0.13: icmp_seq=1 ttl=64 time=0.412 ms (DUP!)
64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=22.6 ms (DUP!)


DDoS
----------------------------------------------------------------------
1. C&C 서버와 좀비PC로 구성된 네트워크를 Botnet라 한다
2. C&C : Command & Control Server 또는 마스터
3. 좀비PC or 좀비 Device or Bot(로봇 줄인말, 명령을 듣는) or slave or Agent
C&C 서버의 (IP)를 가지고 있다, (도메인을 사용)
봇넷은 명령/제어를 위해 사용하는 프로토콜에 따라 IRC, HTTP, P2P 봇넷으로 분류 IRC, HTTP는 중앙집중 P2P는 좀비PC간 명령 전달(분산형)
--------------------------------------------------------------------------



-------  기사 -------------
UDP/ICMP Flooding
 1) 공격 메커니즘 : UDP 또는 ICMP 기반의 단순 전송 계층 프로토콜은 세션 기반 검증을 포함하지 않기 때문에, 공격자는 source IP를 위조한 대량의 요청을 대상에 전송함으로써 대역폭을 포화 상태로 만든다.
 2) 공격 효과 : QoS 저하, 대역폭 자원 고갈, 서비스 불능 상태
 3) 공격 코드 예시 : hping3 --flood --udp -p 80 <target_ip> ping -f <target_ip>
 4) 대응 전략
  (1) 트래픽 기반 임계값 설정 및 ICMP Rate Limiting (예: iptables -A INPUT -p icmp -m limit --limit 1/s -j ACCEPT)
  (2) uRPF(Unicast Reverse Path Forwarding)를 통한 IP 스푸핑 방지
  (3) DDoS Protection Appliance 또는 클라우드 기반 보호 서비스 연동 (ex: Arbor, Cloudflare)


2. DNS Query Flooding
 1) 공격 메커니즘 : DNS는 UDP 기반으로 비연결성이며, 공격자는 다량의 쿼리를 생성하거나 DNS 리플렉션 형태로 트래픽 증폭을 유도한다.
 2) 공격 효과 : DNS 응답 지연, 질의 무시, 서비스 장애
 3) 공격 코드 예시 (Scapy) :    from scapy.all import * 
   send(IP(dst="<dns_ip>")/UDP(dport=53)/DNS(rd=1,qd=DNSQR(qname="example.com")), loop=1)
 4) 대응 전략 
  (1) DNS Rate Limiting (rate-limit directive 적용)
  (2) 응답 무작위화 및 최소 TTL 설정을 통한 응답 캐싱 유도
  (3) Anycast 아키텍처 활용으로 분산 응답 처리

3. TCP SYN Flooding
 1) 공격 메커니즘  (1) TCP의 3-way handshake에서, 공격자는 SYN만 전송하고 ACK를 보내지 않아 서버의 Backlog Queue를 소진시킨다.
  (2) IP Spoofing을 병행해 추적 회피
 2) 공격 효과 : 새로운 세션 생성 차단, 연결 수립 지연
 3) 공격 코드 예시 : hping3 <target_ip> --rand-source -S -p 80 --flood
 4) 대응 전략
  (1) SYN Cookies 기술 활성화 (net.ipv4.tcp_syncookies=1)
  (2) 연결 제한 설정 (conntrack table 최적화)
  (3) SDN 기반 동적 트래픽 제어 및 세션 추적

4. TCP Flag Flooding
 1) 공격 메커니즘
  (1) TCP Header의 플래그 필드를 비정상적으로 조작하여, 예외 처리 루틴을 과도하게 유발
  (2) NULL, XMAS, FIN 스캔 형태와 유사한 접근
 2) 공격 효과 : 비정상 세션 요청 처리로 인한 CPU 사용률 상승, 시스템 리소스 고갈
 3) 공격 코드 예시 : hping3 -c 10000 -SFA -p 80 <target_ip> hping3 -c 10000 -F -p 80 <target_ip>
 4) 대응 전략
  (1) Stateful Inspection Firewall 적용으로 비정상 세션 차단
  (2) IDS/IPS 룰 기반 탐지 (Snort/Suricata Signatures)
  (3) RFC793 기반 TCP 정상 시퀀스 정의 적용

5. TCP Session Flooding
 1) 공격 메커니즘 : 완전한 3-way handshake를 완료한 후, 대량의 세션을 유지시켜 서버의 연결 자원을 고갈
 2) 공격 효과 : 정상 사용자 접속 불가, session timeout 도래 전까지 리소스 점유 지속
 3) 공격 코드 예시 (LOIC/HOIC 유사) : 커스텀 코드 또는 LOIC 사용 (테스트 목적 전용 환경에서만)
 4) 대응 전략
  (1) 애플리케이션 서버의 connection 제한 설정 (worker_connections, MaxClients 등)
  (2) idle session timeout 단축
  (3) Layer 7 Load Balancer 통한 세션 분산
 5) LOIC (Low Orbit Ion Cannon)
  (1) 설명: GUI 기반의 DDoS 공격 도구로, TCP, UDP, HTTP 기반 플러딩을 손쉽게 수행 가능
  (2) 기능
   - 사용자가 직접 타겟을 지정하고 전송 속도, 포트, 요청 수 등 설정 가능
   - HTTP 요청 반복을 통한 L7 DDoS 수행 가능
  (3) 특징
   - 실시간 공격 제어가 가능하지만 URL 변조 기능은 없음
   - 대부분의 WAF 및 IDS에 의해 탐지 쉬움
 6) HOIC (High Orbit Ion Cannon)
  (1) 설명 : LOIC의 확장판으로, ‘booster script’를 통해 공격을 다중화하고 다양화 가능
  (2) 기능
   - 여러 타겟 동시 공격 가능
   - User-Agent 변경, 다중 GET 요청 등 일부 탐지 우회 기능 포함
 
6. HTTP Continuation (Slow Body Attack)
 1) 공격 메커니즘
  (1) HTTP 요청 메시지의 Body를 매우 느리게 전송하여 웹서버가 전체 요청을 수신할 때까지 연결을 유지하게 만듦
  (2) 전형적인 low-and-slow 공격 유형
 2) 공격 효과 : 웹서버의 connection pool 점유율 증가, 대기 시간 지연
 3) 공격 코드 예시 (slowhttptest) : slowhttptest -c 1000 -H -i 10 -r 200 -t GET -u http://<target_ip>/ -x 24 -p 3
 4) 대응 전략
  (1) 요청 수신 시간 제한 (client_body_timeout, RequestReadTimeout 등)
  (2) 웹 애플리케이션 방화벽(WAF)을 통한 body size 및 속도 기반 룰 설정
  (3) 커넥션 모니터링 기반 자동 차단 알고리즘 도입

7. HTTP GET Flooding
 1) 공격 메커니즘
  (1) 동일한 HTTP GET 요청을 반복적으로 전송하여 서버의 리소스를 소모시키는 L7 DDoS 공격
  (2) 정적 파일 요청, URL 재요청 반복을 통해 웹서버 CPU 및 메모리 점유율 증가
 2) 공격 효과 : 웹 서버 과부하, 트래픽 포화, 응답 지연 및 장애
 3) 공격 코드 예시 : perl httpflooder.pl -a GF -h <target_ip> -t 10 -n 100
 4) 대응 전략
  (1) WAF 기반 URL 요청 빈도 필터링
  (2) IP/세션 단위 Rate Limit 설정
  (3) 리버스 프록시 서버 및 캐시 서버 구성 (Nginx + Redis 등)

8. HTTP GET Flooding with Cache-Control (CC Attack)
 1) 공격 메커니즘
  (1) HTTP 요청 헤더에 Cache-Control: no-store 또는 must-revalidate를 삽입하여 캐싱 우회를 유도
  (2) 요청마다 웹서버가 응답을 직접 생성하게 되어 부하 증가
 2) 공격 효과 : 캐시 서버 무력화, 원서버 트래픽 급증, 처리 지연
 3) 공격 코드 예시 (curl 기반) : curl -H "Cache-Control: no-store" http://<target_ip>/target_page -L
 4) 대응 전략
  (1) 캐시 정책 강화 (클라이언트 헤더 무시 설정)
  (2) 요청 필드 기반 필터링 WAF 룰 적용
  (3) 클라이언트 요청 재정의 프록시 구성

9. Slow HTTP POST DoS (R-U-Dead-Yet)
 1) 공격 메커니즘
  (1) HTTP POST 메시지를 매우 느리게 전송하여 서버가 전체 데이터를 수신할 때까지 연결 유지
  (2) 연결 풀 점유 및 처리 지연 유발
 2) 공격 효과 : 웹서버 리소스 지속 점유, 사용자 요청 대기 지연
 3) 공격 코드 예시 (rudy 도구) : perl rudy.pl -t <target_ip> -p 80 -url /login
 4) 대응 전략
  (1) 서버 측 RequestReadTimeout 또는 client_body_timeout 설정
  (2) 최소 송신 속도 기반 차단 기능 설정
  (3) WAF 기반 POST 바디 속도 감지 룰 적용

10. Slow HTTP Header DoS (Slowloris)
 1) 공격 메커니즘
  (1) HTTP Header를 매우 느리게 전송하거나 일부만 전송하여 웹서버가 수신을 완료할 때까지 연결 유지
  (2) Apache, Nginx 등 기본 설정에 따라 수백 개 커넥션 점유 가능
 2) 공격 효과 : 웹서버 동시 접속 제한 초과, 연결 풀 고갈
 3) 공격 코드 예시 (slowloris.pl) : perl slowloris.pl -dns <target_ip> -port 80 -timeout 100 -num 200
 4) 대응 전략
  (1) Apache: mod_reqtimeout 설정
  (2) Nginx: client_header_timeout 설정
  (3) 프록시 서버에서 헤더 전송 제한 필터링

11. Slow HTTP Read DoS
 1) 공격 메커니즘 : 클라이언트가 서버로부터의 응답을 일부만 읽거나 매우 느리게 수신하여, 서버가 송신 큐를 점유한 상태로 유지되도록 유도
 2) 공격 효과 : 웹서버의 전송 큐 고갈, 연결 지연 및 병목 발생
 3) 공격 코드 예시  : 별도 실습
 4) 대응 전략
  (1) TCP output buffer 제한 설정
  (2) 비정상 수신 속도 탐지 IDS 도입
  (3) 연결별 송신 큐 모니터링 기반 자동 차단

12. HashDoS
 1) 공격 메커니즘 : 웹 요청에 수천 개의 POST 파라미터를 포함시켜, 해시 충돌을 유발함으로써 서버 측 해시 테이블 처리 성능 저하 유도
 2) 공격 효과 : CPU 사용률 급등, 웹 애플리케이션 처리 지연
 3) 공격 코드 예시 (Python):
   import requests 
   url = "http://<target_ip>/login" 
   data = {str(i*1000): "A" for i in range(1000)} 
   requests.post(url, data=data)
 4) 대응 전략:
  (1) 요청 파라미터 수 제한 (서버/WAF)
  (2) 충돌 감지 로직 도입 및 해시 알고리즘 개선
  (3) 고성능 파서 및 구조 분산 처리

13. HulkDoS (Randomized GET Flooding)
 1) 공격 메커니즘:
  (1) 요청 URL을 매번 다르게 생성하여 캐싱 우회를 방지하고 웹서버에 지속적인 GET 요청을 수행
  (2) 탐지 우회 및 서버 부하 유도
 2) 공격 효과 : 캐시 무력화, URL 변조 탐지 무력화, 서버 리소스 과다 점유
 3) 공격 코드 예시 (hulk.py) : python hulk.py http://<target_ip>/
 4) 대응 전략:
  (1) WAF 정규표현식 기반 URL 패턴 필터링
  (2) 요청 파라미터 무결성 검증
  (3) 사용자 세션 기반 비정상 요청 탐지

------------------------------
Hash DoS : 웹서버 특성을 악용하여, HTTP Request를 비 정상적인 파라미터(매개정보)를 가진 POST 방식으로 웹서버로 전달, 웹서버는 해당 파라미터를 조회 할 시, 다수의 해시 충돌(Collision)이 발생하여 많은 CPU 자원을 소모
- 웹서버 특성 : 클라이언트(웹 브라우저) HTTP 요청을 통해 전달되는 파라미터를 효율적으로 저장, 검색하기 위한 자료구조로 해시테이블을 주로 사용
보통 Parameter의 Content-Length 헤더필드에 bytes 값을 말도안되는 수준으로 크게 설정, 또는 파라미터명=파라미터값&(파라미터 구분자)로 구성하는 등 비정상 형태로 전송
대응책 : POST 파라미터의 개수 제한 및 POST 메세지 크기 제한이 되도록 설정

암호학
 암호학적 hash함수 또는 일방향 해시함수
MD5 : 128bit /
SHA-1 : 160bit
SHA-2 : SHA-256 : 256bit, SHA-512 : 512bit

Hash
 key-value 쌍의 데이터를 저장하고 검색하기 위한 자료구조이자 알고리즘
 예) key 1은 value A이다. (1,A), (2,B)…. 처럼 저장
 입력값 -> [hash 알고리즘] -> 출력값/해시값/MD(Message Digest)
  - 다양한 크기의 입력값에 대해서 고정 크기 출력값을 가진다.

웹서버 Query String 방식 -> 파라미터명=파라미터값, 해당 페이지에서 참조
Hash함수 데이블에서 key-value를 계속 달아 충돌 발생(colision)

Java –jar hashdostester.jar




(LOIC)툴 설명 - 실습
 1) Manual Mode (Do it yourself) : 사용자가 직접 대상 설정, 공격 옵션 지정, 실행 제어(개별 공격자 또는 실습 시 사용)
 2) IRC Mode (HiveMind) : LOIC 인스턴스들이 IRC 서버에 접속하여 특정 채널의 명령을 받아 동시 제어(봇넷처럼 다수의 공격자 통제 가능)
  (1) 운영자는 특정 채널(ex: #loic)에 명령어 입력 → 모든 클라이언트가 동시에 공격 수행
  (2) 분산 DDoS(Botnet 유사) 환경 구성에 사용(보안사건에서 익명 해커들이 주로 사용했던 방식)
  (3) IRC 모드는 실제 공격자들이 사용한 흔적이 다수 존재하며, 법적 리스크가 큼
  (4) 실습 시에는 반드시 Manual Mode에서 격리된 가상환경 또는 내부 테스트 시스템만 사용해야 함
 3) DAMN OverLord :  독립적인 C2(Command & Control) 방식의 고급 제어 기능으로 알려졌으나, 대부분의 공개 빌드에서는 비활성화(일부 커스텀 빌드에서만 동작, 보통 사용 불가)
 4) LOIC Attack Options 상세 설명
  (1) Timeout : 서버가 응답 없을 경우 대기 시간 설정 (기본 30초)
  (2) HTTP Subsite : HTTP 요청의 대상 URL 경로
  (3) Append random chars to the URL : 요청 URL에 무작위 쿼리 스트링 추가 (ex: /index.html?abc123)
    - 캐시 서버 무력화 (각 요청이 새로운 것으로 보임)
  (4) TCP/UDP message : TCP/UDP 플러딩 시 전송할 메시지 문자열(비정상 데이터 트래픽 유도 (U dun goofed))
  (5) Append random chars to the message : 메시지 문자열 끝에 랜덤값 붙이기(IDS 우회, 패턴 다양화)
  (6) use GET : HTTP 요청 시 GET 방식 사용(기본 HTTP Flood 설정)
  (7) use gzip : 요청에 gzip 인코딩 사용(압축 전송 요구, 일부 서버 리소스 유발)
  (8) Threads : 실행할 병렬 쓰레드 수
  (9) Sockets / Thread : 각 쓰레드가 열 socket 수 (전체 연결 수 = Threads × Sockets)
  (10) Wait for reply : 응답 대기 여부 설정 (비활성화 시 응답 무시하고 계속 요청)

LOIC.exe /hivemind irc.server.address  
LOIC.exe /hivemind irc.server.address 1234 #secret  
LOIC.exe /hidden /hivemind irc.server.address

예) LOIC.exe /hivemind 10.0.0.200 6667 #loic   // (선택사항) IRC의 통신 포트와 채널 이름 (기본: 6667, #loic)
1. 단일 머신에서 발생하는 트래픽은 제한적
현재 실행 중인 LOIC는 단일 호스트(PC)에서만 작동 중
기본 설정으로는 수천 개 요청만 보내며, 서버는 충분히 처리 가능한 수준일 수 있음
실제 DDoS는 수천 대 이상의 장비에서 동시에 발생해야 효과 극대화

2. 서버가 정적 콘텐츠만 처리 중일 가능성
예: Apache/Nginx가 / 요청에 대해 단순 HTML 파일만 리턴한다면 부하가 거의 없음
DB 쿼리나 로그인 로직 없는 페이지는 CPU, 메모리 소모 거의 없음

3. LOIC는 "Flooding" 도구이지, 자원 고갈형 정교한 공격은 아님
요청 양만 많을 뿐, Slowloris, HashDoS처럼 세션 점유, 자원 잠금 공격은 아님
서버가 비정상 요청 처리에 강하다면 방어가 쉬움

4. 네트워크 구조가 너무 단순하거나, 서버 사양이 높음
가상 머신이나 로컬 호스트에서 테스트 중이라면 네트워크 대역폭 병목도 없음
서버가 고사양이거나, 아무런 제한 설정이 없다면 효과가 제한적

5. 부하 유발 방법
 1) Threads × Sockets 증가예: Threads 100 × Sockets 50 = 5,000
 2) 연결캐시 우회 설정 활성화 “Append random chars to the URL” 옵션 체크
 3) 동시 다수 LOIC 클라이언트 실행 최소 3~5개 이상, 다른 머신 또는 VM에서 병렬 실행
 4) 타겟 URL 변경 정적 리소스가 아닌, 로그인 요청 또는 검색 쿼리 등 CPU/DB 유발 경로 설정
 5) 분산 실행 (HiveMind) IRC 서버에 여러 LOIC 연결 후 일제히 공격 (botnet 시뮬레이션)



최근의 DDoS들은 네트워크 프로토콜의 특성을 악용하고 정상적인 서비스를 운영하고 있는 시스템을 공격의 반사체(Reflector)로 이용해 공격 규모를 더욱 증폭(Amplification)시킨다. 이러한 공격을 DRDoS라고 일컫는데, DDoS 보다 한 단계 진화된 공격이라 볼 수 있다.



1. DNS 싱크홀이란, 감염된 컴퓨터(악성 봇)가 명령 및 제어 서버(C&C, Command and Control)에 연결을 시도할 때, 해당 도메인을 의도적으로 잘못된 IP(예: KISA 싱크홀 서버의 IP)로 응답하게 하여 해커와의 통신을 차단하는 기술이다.
즉, 악성 봇이 “해커의 서버로 접속하려고 하는 DNS 요청”을 정상적으로 처리하지 않고, 대신 싱크홀 서버로 보내도록 DNS 응답을 조작하는 방식이다.
 1) 이 서비스는 KISA(한국인터넷진흥원)에서 자체 DNS 서버를 운영하는 기관에게 제공된다.
 2) KISA 싱크홀 서버로 트래픽을 유도하면, 악성 행위를 탐지하고 분석할 수 있는 장점도 있다.
 3) 공격자와의 연결을 차단하여, 악성코드가 추가 명령을 받아 실행되거나 확산되는 것을 방지한다.

2. 공격 흐름
 1) 악성 봇이 명령서버(C&C)에 연결하려는 DNS 요청 발생
 2) DNS 싱크홀에서 해당 요청을 감지
 3) 원래 C&C IP 대신 KISA 싱크홀 IP로 응답
4) 악성 봇은 싱크홀 서버에 접속 → 공격자 명령 차단



DRDoS
*공격명이 DRDoS 또는 Amplification Attack으로 같이 쓰이고 있는데 프로토콜 자체의 특성을 이용하여 증폭률을 높이는 방법, 취약한 서버를 반사체로 이용하는 방법, 두 방법 모두 공격 규모를 증폭시키는 것이 목적이므로, 굳이 공격명을 혼용할 필요가 없다고 판단하여 DRDoS로 통일하여 작성하였다.
1) 10~500배 이상의 트래픽을 증폭시킬 수 있다.
→ 정상적인 서비스를 하는 반사서버(Reflector)와 프로토콜별 특성을 악용해 가능하다.
→ 언제든지 역사적인 규모의 DRDoS가 발생 할 수 있다.
2) 우월한 공격자 은닉이 가능하다.
→ 오류 검사를 하지 않는 UDP 프로토콜의 특징을 이용해 출발지IP Spoofing이 쉽게 가능하고, 수 많은 Reflector와 좀비PC를 경유하므로, 그 근원지의 역추적 또한 거의 불가능하다.
3) 인터넷에 접속된 라우터나 프린터 등 들어오는 패킷에 응답하는 모든 장비들이 잠재적으로 공격에 활용될 수 있다.
→ 2014년 5월 국내 게임업체를 대상으로 NTP DRDoS가 발생하여 KISA에서 조사한 결과, 공격에 사용된 시스템은 냉/난방 관리용 셋톱박스로 밝혀졌다.


공격 실습(1)
반사서버(CentOS) : wireshark* 설치 / promiscuous 체크 해제
대상서버(meta) 
1. 칼리 공격 : hping3 --spoof 위조IP(meta) –s 80 목적지IP(CentOS) –p 22 –S –k –c 10
2. 칼리는 출발지에 위조된 Meta IP/Port 80 을 가지고 CentOS의 22번 포트에 요청을 한다.
3. CetnOS 에서 응답 플래그 SYN+ACK를 META 80번 포트로 전송
2. META에서는 RST를 송신 한다.


공격 실습(2)
from scapy.all import *
victim_ip = "10.0.0.138"          # 타겟 IP
dns_server_ip = "10.0.0.200"    # 증폭 DNS 서버 IP 
dns_query = IP(src=victim_ip, dst=dns_server_ip)/UDP(sport=12345, dport=53)/DNS(rd=1, qd=DNSQR(qname="google.com", qtype=255))
send(dns_query, count=10)





대응방법
1. DRDoS 공격은 출발지 IP가 위조하는 공격이므로 IP주소가 위조된 패킷이 인터넷에 돌아다니지 않도록 ISP에서 차단한다.
2. 반사서버는 icmp 프로토콜을 이용하는 DRDoS에 악의적으로 이용되지 않기위해 icmp프로토콜이 필요가 없는 시스템의 경우 해당 프로토콜을 차단한다.
3. DNS증폭 DRDoS의 반서서버로 DNS서버가 악용되지 않도록 하기 위해서는 내부에만 사용시 내부사용자만 Recursive Query(재귀 쿼리)가 가능하도록 제한한다. 
4. 방화벽을 이용하여 특정 byte 이상 질의를 차단하고거나 동일 IP의 단위 초당 요청 개수를 제한 한다. 
5. NTP 서버의 경우 monlist 명령을 해제한다. ( -n : 주소를 숫자 형식, -c : 질의할 명령어지정)
#ntpd --version 버전 확인
#ntpdc -c monlist <ntp 서버 주소> : 최근에 접속한 클라이언트 정보를 전송해주는 명령
#ntpdate -q time.bora.net ( 정보확인 변경은 하지 않음, -q 제거시 현제 서버에 저장)
#vi /etc/ntp.conf ( disable monitor 설정, monlist 기능 해제 )




1. 출발지 IP 주소를 조작해 자신을 은폐하는 공격을 IP 스푸핑 공격이라 한다.
 # hping3 192.168.0.22 -a 1.1.1.1 -S  ( hping3 <타겟> -a <변조IP> -S )
 # hping3 192.168.0.22 --rand-source -S (특정 IP를 지정하지 않고 랜덤 IP공격 )

2. IP 필터링
ACL (자신의 해당 대역만 허용 하고 나머지 가상 IP를 필터링 하므로서 IP,ICMP 스푸핑을 막을 수 있다. 공인IP는 고민 해보자!)
표준 ACL 방식은 출발지 IP주소 또는 대역에 기반해 필터링 기능을 수행한다. 
(시스코 시스템즈에서 ACL 설정시 사용 가능한 식별 번호는 1-99, 1300-1999이다, 관리자가 임의대로 설정하는 번호이다.)

< ACL 종류 >
- 표준(Standard) ACL : IP 주소 식별(출발지 주소)
                          ACL 번호 = 1 ~ 99, 1300 ~ 1999
- 확장(Extended) ACL : IP 주소 식별(출발지 + 목적지), Protocol, Port number 등을 식별할 수 있다.
                            세부적으로 식별이 가능하나 사용하기가 복잡하다.
                            ACL 번호 = 100 ~ 199, 2000 ~ 2699
- Named ACL : ACL 번호 대신 ACL의 이름을 부여하여 사용(ACL 구분)
                 IOS 11.2 이후 버전에서 사용가능하다.


https://www.unrealircd.org/


alert icmp 10.0.0.0/8 any -> 10.0.0.200 any (msg:"To Detected ICMP 10.0.0.x"; sid:2025122601;)
alert icmp 172.16.0.0/16 any -> 10.0.0.200 any (msg:"To Detected ICMP 172.16.0.x"; sid:2025122602;)
alert icmp 192.168.0.0/16 any -> 10.0.0.200 any (msg:"To Detected ICMP 192.168.0.x"; sid:2025122603;)


Land attack 
해결방법 : Ping 크기제한, IDS 구축, 특정패턴 및 시간 제어
대응책 : 대부분 OS 및 방화벽에서 출발지와 목적지 IP가 동일한 패킷은 모두 Drop하기 때문에, 현재는 이론상 존재하는 공격 기법


Smurf Attack
브로드캐스트(Broadcast, 1:여러대) 를 악용하는 공격 기법이다. 공격자는 목적지 IP주소를 브로드캐스트로 설정하고 출발지 IP주소를 공격 대상으로 설정 하여 ICMP Echo Request 패킷을 보내 공격 대상에게 수많은(Amplifier,Bounce 증폭 또는 바운스) ICMP Echo Reply 패킷이 수신되도록 하여 시스템 과부하 상태로 만든다. 
Local Broadcast : 255.255.255.255
Directed Broadcast : 192.168.0.255 (원격지 호스트 ID 비트가 모두 1이며, 원격지의 Directed Broadcast가 활성화 되어야 한다. 하지만 보안상의 문제로 허용하지 않는다.)


# hping3 --icmp --spoof -d 1 192.168.0.7 192.168.0.255 --fast
# hping3 --icmp 192.168.0.255 -d 1 --spoof 192.168.0.7
# hping3 192.168.0.255 -a 192.168.0.7 -icmp --flood
# hping3 192.168.0.255 -a 192.168.0.18 --icmp --flood -d 65000



Ping of Death 뜻  (가용성, available)
비정상적으로 큰 ICMP 패킷을 보내 대상 시스템을 다운시키는 DoS 공격(단편화/재조립 과정)


대응방법
라우터에서 다른 네트워크에서 자신의 네트워크로 들어오는 IP브로드캐스트 패킷을 차단한다.
라우터에서 Directed Broadcast를 Disable시킨다. (Router : no ip directed-broadcast)
라우터에서 Ingress Filtering을 이용하여 Spoof된 패킷(중간에 가로채서 변경)을 차단한다.
호스트는 IP브로드캐스트로 전송된 ICMP패킷에 대해 응답하지 않게 설정한다.

alert icmp any any -> any any (msg:"....."; sid:2025121201;)




